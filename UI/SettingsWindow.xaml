<Window
    x:Class="Pulse.UI.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="clr-namespace:Pulse.UI"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    Title="Pulse — Settings"
    Width="540"
    Height="500"
    MinWidth="420"
    MinHeight="380"
    AllowsTransparency="True"
    Background="Transparent"
    WindowStyle="None"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/Pulse;component/UI/Themes/DarkTheme.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Dark.xaml" />
                <ResourceDictionary Source="pack://application:,,,/Pulse;component/UI/Themes/ElementStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <!-- Borderless TextBox style for dark theme -->
            <Style x:Key="DarkTextBoxStyle" TargetType="{x:Type TextBox}">
                <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}" />
                <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}" />
                <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
                <Setter Property="BorderThickness" Value="1" />
                <Setter Property="Padding" Value="7,5" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="CaretBrush" Value="{DynamicResource ForegroundBrush}" />
                <Setter Property="SelectionBrush" Value="#FF0078D7" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type TextBox}">
                            <Border x:Name="Bd"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="4"
                                    Padding="{TemplateBinding Padding}">
                                <ScrollViewer x:Name="PART_ContentHost"
                                              Focusable="False"
                                              HorizontalScrollBarVisibility="Hidden"
                                              VerticalScrollBarVisibility="Hidden" />
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsFocused" Value="True">
                                    <Setter TargetName="Bd" Property="BorderBrush" Value="#FF0078D7" />
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Bd" Property="BorderBrush" Value="{DynamicResource IconForegroundBrush}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Background="Transparent">
        <!-- Frosted-glass edge glow -->
        <Border BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="2"
                CornerRadius="10"
                Opacity="0.7"
                SnapsToDevicePixels="True">
            <Border.Effect>
                <BlurEffect KernelType="Gaussian" Radius="2" />
            </Border.Effect>
        </Border>

        <!-- Main surface -->
        <Border Margin="2"
                Background="{DynamicResource PrimaryBackgroundBrush}"
                CornerRadius="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="30" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- ── Title bar ─────────────────────────────────────────── -->
                <ui:TitleBar Grid.Row="0" IsMinimizeVisible="False" />

                <!-- ── Scrollable content ────────────────────────────────── -->
                <ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto"
                              Padding="20,14,20,0">
                    <StackPanel>

                        <!-- Module header -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,3">
                            <materialDesign:PackIcon Kind="Fire"
                                                     Width="20" Height="20"
                                                     Foreground="#FFDC6B6B"
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,8,0" />
                            <TextBlock Text="{Binding ModuleName}"
                                       FontSize="16" FontWeight="Bold"
                                       Foreground="{DynamicResource ForegroundBrush}"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        <TextBlock Text="{Binding ModuleDescription}"
                                   FontSize="10"
                                   Foreground="{DynamicResource IconForegroundBrush}"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,14" />

                        <Border Height="1" Background="{DynamicResource BorderBrush}" Margin="0,0,0,14" />

                        <!-- ── Revit Category ─────────────────────────────────── -->
                        <TextBlock Text="REVIT CATEGORY"
                                   FontSize="10" FontWeight="SemiBold"
                                   Foreground="{DynamicResource IconForegroundBrush}"
                                   Margin="0,0,0,4" />
                        <TextBlock FontSize="10"
                                   Foreground="{DynamicResource IconForegroundBrush}"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,6"
                                   Text="The Revit category containing your system devices (e.g. 'Fire Alarm Devices')." />
                        <TextBox Text="{Binding RevitCategory, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{StaticResource DarkTextBoxStyle}"
                                 Margin="0,0,0,18" />

                        <Border Height="1" Background="{DynamicResource BorderBrush}" Margin="0,0,0,14" />

                        <!-- ── Parameter Mappings ─────────────────────────────── -->
                        <TextBlock Text="PARAMETER MAPPINGS"
                                   FontSize="10" FontWeight="SemiBold"
                                   Foreground="{DynamicResource IconForegroundBrush}"
                                   Margin="0,0,0,4" />
                        <TextBlock FontSize="10"
                                   Foreground="{DynamicResource IconForegroundBrush}"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"
                                   Text="Enter the exact Revit parameter name for each logical field. These must match the shared parameter names in your families." />

                        <!-- Column header row -->
                        <Grid Margin="0,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="130" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="72" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0"
                                       Text="Logical Field"
                                       FontSize="10" FontWeight="SemiBold"
                                       Foreground="{DynamicResource IconForegroundBrush}" />
                            <TextBlock Grid.Column="1"
                                       Text="Revit Parameter Name"
                                       FontSize="10" FontWeight="SemiBold"
                                       Foreground="{DynamicResource IconForegroundBrush}"
                                       Margin="8,0,0,0" />
                            <TextBlock Grid.Column="2"
                                       Text="Required"
                                       FontSize="10" FontWeight="SemiBold"
                                       Foreground="{DynamicResource IconForegroundBrush}"
                                       HorizontalAlignment="Center" />
                        </Grid>

                        <!-- Mapping rows -->
                        <ItemsControl ItemsSource="{Binding Mappings}" Margin="0,0,0,12">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,3">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="130" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="72" />
                                        </Grid.ColumnDefinitions>

                                        <!-- Logical name label -->
                                        <TextBlock Grid.Column="0"
                                                   Text="{Binding LogicalName}"
                                                   FontSize="12"
                                                   VerticalAlignment="Center"
                                                   Foreground="{DynamicResource ForegroundBrush}" />

                                        <!-- Editable Revit parameter name -->
                                        <TextBox Grid.Column="1"
                                                 Text="{Binding RevitParameterName, UpdateSourceTrigger=PropertyChanged}"
                                                 Style="{StaticResource DarkTextBoxStyle}"
                                                 Margin="8,0,6,0" />

                                        <!-- Required / Optional badge -->
                                        <Border Grid.Column="2"
                                                CornerRadius="3"
                                                Padding="6,2"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsRequired}" Value="True">
                                                            <Setter Property="Background" Value="#FFDC6B6B" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsRequired}" Value="False">
                                                            <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock FontSize="9" FontWeight="SemiBold" VerticalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsRequired}" Value="True">
                                                                <Setter Property="Text" Value="Required" />
                                                                <Setter Property="Foreground" Value="White" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding IsRequired}" Value="False">
                                                                <Setter Property="Text" Value="Optional" />
                                                                <Setter Property="Foreground" Value="{DynamicResource IconForegroundBrush}" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Border>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                    </StackPanel>
                </ScrollViewer>

                <!-- ── Footer ─────────────────────────────────────────────── -->
                <Border Grid.Row="2"
                        Background="{DynamicResource SecondaryBackgroundBrush}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="0,1,0,0"
                        CornerRadius="0,0,8,8"
                        Padding="16,8">
                    <DockPanel>
                        <!-- Reset to Defaults (left-aligned) -->
                        <Button Style="{StaticResource PulseActionButtonStyle}"
                                Command="{Binding ResetDefaultsCommand}"
                                ToolTip="Restore all mappings to factory defaults"
                                DockPanel.Dock="Left">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Restore" Width="14" Height="14"
                                                         VerticalAlignment="Center" Margin="0,0,4,0" />
                                <TextBlock Text="Reset to Defaults" FontSize="11" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button>

                        <!-- Cancel / Save (right-aligned) -->
                        <StackPanel Orientation="Horizontal"
                                    DockPanel.Dock="Right"
                                    HorizontalAlignment="Right">
                            <Button Style="{StaticResource PulseActionButtonStyle}"
                                    Command="{Binding CancelCommand}"
                                    Margin="0,0,8,0">
                                <TextBlock Text="Cancel" FontSize="11" />
                            </Button>
                            <Button Style="{StaticResource PulsePrimaryButtonStyle}"
                                    Command="{Binding SaveCommand}"
                                    ToolTip="Save settings and persist to this Revit document">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="ContentSave" Width="14" Height="14"
                                                             VerticalAlignment="Center" Margin="0,0,4,0" />
                                    <TextBlock Text="Save" FontSize="11" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </DockPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
