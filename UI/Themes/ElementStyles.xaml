<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">

    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.ComboBox.xaml" />
        <ResourceDictionary Source="pack://application:,,,/Pulse;component/UI/Themes/DarkTheme.xaml" />
    </ResourceDictionary.MergedDictionaries>

    <!-- ======================== -->
    <!--  Pulse Action Button     -->
    <!-- ======================== -->
    <Style x:Key="PulseActionButtonStyle" TargetType="{x:Type Button}">
        <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}" />
        <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="Padding" Value="12,6" />
        <Setter Property="FontSize" Value="12" />
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Button}">
                    <Border
                        x:Name="ButtonBorder"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="5"
                        Padding="{TemplateBinding Padding}">
                        <ContentPresenter
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="ButtonBorder" Property="Background" Value="{DynamicResource HighlightBrush}" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="ButtonBorder" Property="Background" Value="{DynamicResource SelectionHoverBrush}" />
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Opacity" Value="0.5" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ======================== -->
    <!--  Pulse Primary Button    -->
    <!-- ======================== -->
    <Style x:Key="PulsePrimaryButtonStyle" TargetType="{x:Type Button}" BasedOn="{StaticResource PulseActionButtonStyle}">
        <Setter Property="Background" Value="#FF0078D7" />
        <Setter Property="Foreground" Value="White" />
        <Setter Property="BorderBrush" Value="#FF0078D7" />
    </Style>

    <!-- ======================== -->
    <!--  TreeView Node Style     -->
    <!-- ======================== -->
    <Style x:Key="TopologyTreeViewItemStyle" TargetType="{x:Type TreeViewItem}">
        <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}" />
        <Setter Property="FontSize" Value="12" />
        <Setter Property="Padding" Value="2,1" />
        <Setter Property="IsExpanded" Value="True" />
        <Style.Triggers>
            <Trigger Property="IsSelected" Value="True">
                <Setter Property="Background" Value="{DynamicResource HighlightBrush}" />
            </Trigger>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="{DynamicResource SelectionHoverBrush}" />
            </Trigger>
        </Style.Triggers>
    </Style>

    <!-- ======================== -->
    <!--  ScrollBar — full dark   -->
    <!-- ======================== -->

    <!-- Shared sub-templates referenced by both named styles below -->
    <ControlTemplate x:Key="PulseScrollThumbTemplate" TargetType="{x:Type Thumb}">
        <Border x:Name="Bd"
                Background="{StaticResource ScrollBarThumbBrush}"
                CornerRadius="3"
                Opacity="0.55" />
        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="Bd" Property="Opacity" Value="0.85" />
            </Trigger>
            <Trigger Property="IsDragging" Value="True">
                <Setter TargetName="Bd" Property="Opacity" Value="1" />
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!-- Invisible repeat buttons (no arrows) -->
    <Style x:Key="PulseScrollRepeatButton" TargetType="{x:Type RepeatButton}">
        <Setter Property="OverridesDefaultStyle" Value="True" />
        <Setter Property="Focusable" Value="False" />
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type RepeatButton}">
                    <Border Background="Transparent" />
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Implicit ScrollBar style (no x:Key → applies to every ScrollBar) -->
    <Style TargetType="{x:Type ScrollBar}">
        <Setter Property="OverridesDefaultStyle" Value="True" />
        <Setter Property="SnapsToDevicePixels"   Value="True" />
        <Setter Property="Width"                 Value="8" />
        <Setter Property="MinWidth"              Value="8" />
        <Setter Property="Background"            Value="Transparent" />
        <Setter Property="Template">
            <Setter.Value>
                <!-- Vertical template -->
                <ControlTemplate TargetType="{x:Type ScrollBar}">
                    <Grid Background="Transparent">
                        <Track x:Name="PART_Track" IsDirectionReversed="True">
                            <Track.DecreaseRepeatButton>
                                <RepeatButton Style="{StaticResource PulseScrollRepeatButton}"
                                              Command="ScrollBar.PageUpCommand" />
                            </Track.DecreaseRepeatButton>
                            <Track.Thumb>
                                <Thumb Template="{StaticResource PulseScrollThumbTemplate}"
                                       Margin="2,0" />
                            </Track.Thumb>
                            <Track.IncreaseRepeatButton>
                                <RepeatButton Style="{StaticResource PulseScrollRepeatButton}"
                                              Command="ScrollBar.PageDownCommand" />
                            </Track.IncreaseRepeatButton>
                        </Track>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <!-- Horizontal variant — swap dimensions and use a horizontal track -->
        <Style.Triggers>
            <Trigger Property="Orientation" Value="Horizontal">
                <Setter Property="Height"    Value="8" />
                <Setter Property="MinHeight" Value="8" />
                <Setter Property="Width"     Value="Auto" />
                <Setter Property="MinWidth"  Value="0" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ScrollBar}">
                            <Grid Background="Transparent">
                                <Track x:Name="PART_Track" IsDirectionReversed="False">
                                    <Track.DecreaseRepeatButton>
                                        <RepeatButton Style="{StaticResource PulseScrollRepeatButton}"
                                                      Command="ScrollBar.PageLeftCommand" />
                                    </Track.DecreaseRepeatButton>
                                    <Track.Thumb>
                                        <Thumb Template="{StaticResource PulseScrollThumbTemplate}"
                                               Margin="0,2" />
                                    </Track.Thumb>
                                    <Track.IncreaseRepeatButton>
                                        <RepeatButton Style="{StaticResource PulseScrollRepeatButton}"
                                                      Command="ScrollBar.PageRightCommand" />
                                    </Track.IncreaseRepeatButton>
                                </Track>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Trigger>
        </Style.Triggers>
    </Style>

    <!-- ================================================================ -->
    <!--  PulseScrollViewerStyle  — explicit-keyed dark ScrollViewer       -->
    <!--  Apply with: Style="{StaticResource PulseScrollViewerStyle}"      -->
    <!-- ================================================================ -->
    <Style x:Key="PulseScrollViewerStyle" TargetType="{x:Type ScrollViewer}">
        <Setter Property="OverridesDefaultStyle"         Value="True" />
        <Setter Property="Background"                    Value="Transparent" />
        <Setter Property="VerticalScrollBarVisibility"   Value="Auto" />
        <Setter Property="HorizontalScrollBarVisibility" Value="Hidden" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ScrollViewer}">
                    <Grid SnapsToDevicePixels="True">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <ScrollContentPresenter Grid.Column="0"
                                                CanContentScroll="{TemplateBinding CanContentScroll}" />
                        <ScrollBar x:Name="PART_VerticalScrollBar"
                                   Grid.Column="1"
                                   Orientation="Vertical"
                                   Minimum="0"
                                   Maximum="{TemplateBinding ScrollableHeight}"
                                   ViewportSize="{TemplateBinding ViewportHeight}"
                                   Value="{TemplateBinding VerticalOffset}"
                                   Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                   OverridesDefaultStyle="True"
                                   Width="14" Background="Transparent">
                            <ScrollBar.Template>
                                <ControlTemplate TargetType="{x:Type ScrollBar}">
                                    <Grid Background="Transparent" SnapsToDevicePixels="True">
                                        <Border Background="{StaticResource SecondaryBackgroundBrush}" CornerRadius="4" />
                                        <Track x:Name="PART_Track" Margin="3,0" IsDirectionReversed="True"
                                               Minimum="{TemplateBinding Minimum}"
                                               Maximum="{TemplateBinding Maximum}"
                                               Orientation="{TemplateBinding Orientation}"
                                               ViewportSize="{TemplateBinding ViewportSize}"
                                               Value="{TemplateBinding Value}">
                                            <Track.DecreaseRepeatButton><RepeatButton Visibility="Collapsed" /></Track.DecreaseRepeatButton>
                                            <Track.Thumb>
                                                <Thumb OverridesDefaultStyle="True"
                                                       Template="{StaticResource PulseScrollThumbTemplate}" />
                                            </Track.Thumb>
                                            <Track.IncreaseRepeatButton><RepeatButton Visibility="Collapsed" /></Track.IncreaseRepeatButton>
                                        </Track>
                                    </Grid>
                                </ControlTemplate>
                            </ScrollBar.Template>
                        </ScrollBar>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ================================================================ -->
    <!--  PulseTreeViewStyle  — explicit-keyed dark TreeView               -->
    <!--  Apply with: Style="{StaticResource PulseTreeViewStyle}"          -->
    <!--  (wrap-in-ScrollViewer approach; bypasses MDT's internal SV)      -->
    <!-- ================================================================ -->
    <Style x:Key="PulseTreeViewStyle" TargetType="{x:Type TreeView}">
        <Setter Property="OverridesDefaultStyle" Value="True" />
        <Setter Property="Background"            Value="Transparent" />
        <Setter Property="BorderThickness"       Value="0" />
        <Setter Property="VirtualizingStackPanel.IsVirtualizing" Value="True" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type TreeView}">
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">
                        <ScrollViewer Focusable="False"
                                      HorizontalScrollBarVisibility="Hidden"
                                      VerticalScrollBarVisibility="Auto"
                                      CanContentScroll="True"
                                      OverridesDefaultStyle="True"
                                      SnapsToDevicePixels="True">
                            <ScrollViewer.Template>
                                <ControlTemplate TargetType="{x:Type ScrollViewer}">
                                    <Grid SnapsToDevicePixels="True">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <ScrollContentPresenter Grid.Column="0"
                                                                CanContentScroll="{TemplateBinding CanContentScroll}" />
                                        <ScrollBar x:Name="PART_VerticalScrollBar"
                                                   Grid.Column="1"
                                                   Orientation="Vertical"
                                                   Minimum="0"
                                                   Maximum="{TemplateBinding ScrollableHeight}"
                                                   ViewportSize="{TemplateBinding ViewportHeight}"
                                                   Value="{TemplateBinding VerticalOffset}"
                                                   Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                                   OverridesDefaultStyle="True"
                                                   Width="14" Background="Transparent">
                                            <ScrollBar.Template>
                                                <ControlTemplate TargetType="{x:Type ScrollBar}">
                                                    <Grid Background="Transparent" SnapsToDevicePixels="True">
                                                        <Border Background="{StaticResource SecondaryBackgroundBrush}" CornerRadius="4" />
                                                        <Track x:Name="PART_Track" Margin="3,0" IsDirectionReversed="True"
                                                               Minimum="{TemplateBinding Minimum}"
                                                               Maximum="{TemplateBinding Maximum}"
                                                               Orientation="{TemplateBinding Orientation}"
                                                               ViewportSize="{TemplateBinding ViewportSize}"
                                                               Value="{TemplateBinding Value}">
                                                            <Track.DecreaseRepeatButton><RepeatButton Visibility="Collapsed" /></Track.DecreaseRepeatButton>
                                                            <Track.Thumb>
                                                                <Thumb OverridesDefaultStyle="True"
                                                                       Template="{StaticResource PulseScrollThumbTemplate}" />
                                                            </Track.Thumb>
                                                            <Track.IncreaseRepeatButton><RepeatButton Visibility="Collapsed" /></Track.IncreaseRepeatButton>
                                                        </Track>
                                                    </Grid>
                                                </ControlTemplate>
                                            </ScrollBar.Template>
                                        </ScrollBar>
                                    </Grid>
                                </ControlTemplate>
                            </ScrollViewer.Template>
                            <ItemsPresenter />
                        </ScrollViewer>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ======================== -->
    <!--  Pulse Node Button Style -->
    <!--  (clickable topology row) -->
    <!-- ======================== -->
    <Style x:Key="PulseNodeButtonStyle" TargetType="{x:Type Button}">
        <Setter Property="OverridesDefaultStyle" Value="True" />
        <Setter Property="Background"            Value="Transparent" />
        <Setter Property="Foreground"            Value="{DynamicResource ForegroundBrush}" />
        <Setter Property="BorderThickness"       Value="0" />
        <Setter Property="Padding"               Value="0" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
        <Setter Property="Cursor"                Value="Hand" />
        <Setter Property="FocusVisualStyle"      Value="{x:Null}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Button}">
                    <Border x:Name="Bg"
                            Background="{TemplateBinding Background}"
                            Padding="{TemplateBinding Padding}">
                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                          VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="{DynamicResource HighlightBrush}" />
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="Bg" Property="Background" Value="{DynamicResource SelectionHoverBrush}" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ======================== -->
    <!--  Card Border Style       -->
    <!-- ======================== -->
    <Style x:Key="CardBorderStyle" TargetType="{x:Type Border}">
        <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="CornerRadius" Value="5" />
        <Setter Property="Padding" Value="8" />
    </Style>

    <!-- ================================================ -->
    <!--  PulseExpanderStyle  —  collapsible section card   -->
    <!-- ================================================ -->
    <Style x:Key="PulseExpanderStyle" TargetType="{x:Type Expander}">
        <Setter Property="OverridesDefaultStyle" Value="True" />
        <Setter Property="IsExpanded"            Value="True" />
        <Setter Property="Background"            Value="Transparent" />
        <Setter Property="Foreground"            Value="{DynamicResource ForegroundBrush}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Expander}">
                    <Border Background="{StaticResource SecondaryBackgroundBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="5"
                            Margin="0,0,0,6">
                        <StackPanel>
                            <!-- Header toggle button -->
                            <ToggleButton x:Name="HeaderToggle"
                                          IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                                          OverridesDefaultStyle="True"
                                          Cursor="Hand"
                                          Focusable="False">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                                        <Border x:Name="Hd"
                                                Background="Transparent"
                                                CornerRadius="5,5,0,0"
                                                Padding="10,7">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <ContentPresenter Grid.Column="0"
                                                                  Content="{TemplateBinding Tag}"
                                                                  VerticalAlignment="Center"/>
                                                <!-- Chevron -->
                                                <Path x:Name="Chevron" Grid.Column="1"
                                                      Data="M 0,0 L 4,4 L 8,0"
                                                      Stroke="{StaticResource IconForegroundBrush}"
                                                      StrokeThickness="1.5"
                                                      StrokeLineJoin="Round"
                                                      Width="8" Height="4"
                                                      VerticalAlignment="Center"
                                                      RenderTransformOrigin="0.5,0.5">
                                                    <Path.RenderTransform>
                                                        <RotateTransform x:Name="ChevronRot" Angle="0"/>
                                                    </Path.RenderTransform>
                                                </Path>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="Hd" Property="Background" Value="{StaticResource HighlightBrush}"/>
                                            </Trigger>
                                            <Trigger Property="IsChecked" Value="False">
                                                <Trigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetName="ChevronRot"
                                                                             Storyboard.TargetProperty="Angle"
                                                                             To="-90" Duration="0:0:0.15"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </Trigger.EnterActions>
                                                <Trigger.ExitActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <DoubleAnimation Storyboard.TargetName="ChevronRot"
                                                                             Storyboard.TargetProperty="Angle"
                                                                             To="0" Duration="0:0:0.15"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </Trigger.ExitActions>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                                <ToggleButton.Tag>
                                    <ContentPresenter Content="{Binding Header, RelativeSource={RelativeSource AncestorType={x:Type Expander}}}"/>
                                </ToggleButton.Tag>
                            </ToggleButton>
                            <!-- Divider (only when expanded) -->
                            <Border x:Name="Divider"
                                    Height="1"
                                    Background="{StaticResource BorderBrush}"
                                    Margin="0"/>
                            <!-- Content -->
                            <ContentPresenter x:Name="ExpandContent"
                                              Margin="10,8,10,10"
                                              Visibility="Visible"/>
                        </StackPanel>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsExpanded" Value="False">
                            <Setter TargetName="ExpandContent" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="Divider"        Property="Visibility" Value="Collapsed"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ======================== -->
    <!--  Status Badge Styles     -->
    <!-- ======================== -->
    <Style x:Key="ErrorBadgeStyle" TargetType="{x:Type Border}">
        <Setter Property="Background" Value="#FFDC6B6B" />
        <Setter Property="CornerRadius" Value="8" />
        <Setter Property="Padding" Value="6,2" />
        <Setter Property="Margin" Value="4,0" />
    </Style>

    <Style x:Key="WarningBadgeStyle" TargetType="{x:Type Border}">
        <Setter Property="Background" Value="#FFFFC107" />
        <Setter Property="CornerRadius" Value="8" />
        <Setter Property="Padding" Value="6,2" />
        <Setter Property="Margin" Value="4,0" />
    </Style>

    <Style x:Key="InfoBadgeStyle" TargetType="{x:Type Border}">
        <Setter Property="Background" Value="#FF64B5F6" />
        <Setter Property="CornerRadius" Value="8" />
        <Setter Property="Padding" Value="6,2" />
        <Setter Property="Margin" Value="4,0" />
    </Style>

    <!-- ======================== -->
    <!--  Toggle Button Style     -->
    <!-- ======================== -->
    <Style x:Key="PulseToggleButtonStyle" TargetType="{x:Type ToggleButton}">
        <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}" />
        <Setter Property="Foreground" Value="{DynamicResource ForegroundBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="Padding" Value="8,4" />
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ToggleButton}">
                    <Border
                        x:Name="ToggleBorder"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="5"
                        Padding="{TemplateBinding Padding}">
                        <ContentPresenter
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center" />
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsChecked" Value="True">
                            <Setter TargetName="ToggleBorder" Property="Background" Value="#FF0078D7" />
                            <Setter Property="Foreground" Value="White" />
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="ToggleBorder" Property="Background" Value="{DynamicResource HighlightBrush}" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
